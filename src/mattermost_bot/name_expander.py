"""Утилита для преобразования коротких имен в полные имена."""

import re
from typing import Dict

# Словарь соответствий коротких имен полным именам
# Ключ - короткое имя (в нижнем регистре), значение - полное имя
# Включает основные падежные формы
NAME_MAPPINGS: Dict[str, str] = {
    "коля": "Николай",
    "коли": "Николая",  # родительный падеж
    "коле": "Николаю",  # дательный падеж
    "николя": "Николай",
    "света": "Светлана",
    "светы": "Светланы",  # родительный падеж
    "свете": "Светлане",  # дательный падеж
    "стас": "Станислав",
    "стаса": "Станислава",  # родительный падеж
    "стасу": "Станиславу",  # дательный падеж
    "вася": "Василий",
    "васи": "Василия",  # родительный падеж
    "васе": "Василию",  # дательный падеж
    "василий": "Василий",
    "василия": "Василия",  # родительный падеж
    "петя": "Петр",
    "пети": "Петра",  # родительный падеж
    "пете": "Петру",  # дательный падеж
    "петр": "Петр",
    "петра": "Петра",  # родительный падеж
    "саша": "Александр",
    "саши": "Александра",  # родительный падеж
    "саше": "Александру",  # дательный падеж
    "сашей": "Александром",  # творительный падеж
    "саня": "Александр",
    "сани": "Александра",  # родительный падеж
    "сане": "Александру",  # дательный падеж
    "саней": "Александром",  # творительный падеж
    "александр": "Александр",
    "александра": "Александра",  # родительный падеж
    "александру": "Александру",  # дательный падеж
    "маша": "Мария",
    "маши": "Марии",  # родительный падеж
    "маше": "Марии",  # дательный падеж
    "марией": "Марией",  # творительный падеж
    "мария": "Мария",
    "даша": "Дарья",
    "даши": "Дарьи",  # родительный падеж
    "даше": "Дарье",  # дательный падеж
    "дарья": "Дарья",
    "настя": "Анастасия",
    "насти": "Анастасии",  # родительный падеж
    "насте": "Анастасии",  # дательный падеж
    "настюша": "Анастасия",
    "анастасия": "Анастасия",
    "анастасии": "Анастасии",  # родительный падеж
    "катя": "Екатерина",
    "кати": "Екатерины",  # родительный падеж
    "кате": "Екатерине",  # дательный падеж
    "катюша": "Екатерина",
    "екатерина": "Екатерина",
    "екатерины": "Екатерины",  # родительный падеж
    "оля": "Ольга",
    "оли": "Ольги",  # родительный падеж
    "оле": "Ольге",  # дательный падеж
    "ольга": "Ольга",
    "ольги": "Ольги",  # родительный падеж
    "лена": "Елена",
    "лены": "Елены",  # родительный падеж
    "лене": "Елене",  # дательный падеж
    "елена": "Елена",
    "елены": "Елены",  # родительный падеж
    "юля": "Юлия",
    "юли": "Юлии",  # родительный падеж
    "юле": "Юлии",  # дательный падеж
    "юлия": "Юлия",
    "таня": "Татьяна",
    "тани": "Татьяны",  # родительный падеж
    "тане": "Татьяне",  # дательный падеж
    "татьяна": "Татьяна",
    "татьяны": "Татьяны",  # родительный падеж
    "ира": "Ирина",
    "иры": "Ирины",  # родительный падеж
    "ире": "Ирине",  # дательный падеж
    "ирина": "Ирина",
    "ирины": "Ирины",  # родительный падеж
    "наташа": "Наталья",
    "наташи": "Натальи",  # родительный падеж
    "наташе": "Наталье",  # дательный падеж
    "наталья": "Наталья",
    "натальи": "Натальи",  # родительный падеж
    "ваня": "Иван",
    "вани": "Ивана",  # родительный падеж
    "ване": "Ивану",  # дательный падеж
    "иван": "Иван",
    "ивана": "Ивана",  # родительный падеж
    "миша": "Михаил",
    "миши": "Михаила",  # родительный падеж
    "мише": "Михаилу",  # дательный падеж
    "михаил": "Михаил",
    "михаила": "Михаила",  # родительный падеж
    "дима": "Дмитрий",
    "димы": "Дмитрия",  # родительный падеж
    "диме": "Дмитрию",  # дательный падеж
    "дмитрий": "Дмитрий",
    "дмитрия": "Дмитрия",  # родительный падеж
    "серёжа": "Сергей",
    "серёжи": "Сергея",  # родительный падеж
    "серёже": "Сергею",  # дательный падеж
    "сергей": "Сергей",
    "сергея": "Сергея",  # родительный падеж
    "андрей": "Андрей",
    "андрея": "Андрея",  # родительный падеж
    "андрею": "Андрею",  # дательный падеж
    "андрюша": "Андрей",
    "андрюши": "Андрея",  # родительный падеж
    "максим": "Максим",
    "макс": "Максим",
    "артём": "Артём",
    "артем": "Артём",
    "артюша": "Артём",
    "рома": "Роман",
    "роман": "Роман",
    "витя": "Виктор",
    "вити": "Виктора",  # родительный падеж
    "вите": "Виктору",  # дательный падеж
    "виктор": "Виктор",
    "виктора": "Виктора",  # родительный падеж
    "паша": "Павел",
    "паши": "Павла",  # родительный падеж
    "паше": "Павлу",  # дательный падеж
    "павел": "Павел",
    "павла": "Павла",  # родительный падеж
    "кирилл": "Кирилл",
    "кирил": "Кирилл",
    "леша": "Алексей",
    "леши": "Алексея",  # родительный падеж
    "леше": "Алексею",  # дательный падеж
    "алексей": "Алексей",
    "алексея": "Алексея",  # родительный падеж
    "валера": "Валерий",
    "валеры": "Валерия",  # родительный падеж
    "валере": "Валерию",  # дательный падеж
    "валерий": "Валерий",
    "валерия": "Валерия",  # родительный падеж
    "юра": "Юрий",
    "юры": "Юрия",  # родительный падеж
    "юре": "Юрию",  # дательный падеж
    "юрий": "Юрий",
    "юрия": "Юрия",  # родительный падеж
    "игорь": "Игорь",
    "игоря": "Игоря",  # родительный падеж
    "игорю": "Игорю",  # дательный падеж
    "игорек": "Игорь",
    "игорька": "Игоря",  # родительный падеж
    "женя": "Евгений",
    "жени": "Евгения",  # родительный падеж (муж.)
    "жене": "Евгению",  # дательный падеж (муж.)
    "евгений": "Евгений",
    "евгения": "Евгения",  # родительный падеж (муж.) / женское имя
    "евгении": "Евгении",  # родительный падеж (жен.)
    "оля": "Олег",
    "олег": "Олег",
    "вова": "Владимир",
    "вовы": "Владимира",  # родительный падеж
    "вове": "Владимиру",  # дательный падеж
    "владимир": "Владимир",
    "владимира": "Владимира",  # родительный падеж
    "влад": "Владислав",
    "влада": "Владислава",  # родительный падеж
    "владу": "Владиславу",  # дательный падеж
    "владислав": "Владислав",
    "владислава": "Владислава",  # родительный падеж
    "борис": "Борис",
    "бориса": "Бориса",  # родительный падеж
    "борису": "Борису",  # дательный падеж
    "гриша": "Григорий",
    "гриши": "Григория",  # родительный падеж
    "грише": "Григорию",  # дательный падеж
    "григорий": "Григорий",
    "григория": "Григория",  # родительный падеж
    "тима": "Тимофей",
    "тимы": "Тимофея",  # родительный падеж
    "тиме": "Тимофею",  # дательный падеж
    "тимофей": "Тимофей",
    "тимофея": "Тимофея",  # родительный падеж
    "федя": "Фёдор",
    "феди": "Фёдора",  # родительный падеж
    "феде": "Фёдору",  # дательный падеж
    "федор": "Фёдор",
    "фёдор": "Фёдор",
    "фёдора": "Фёдора",  # родительный падеж
}


def expand_name_in_text(text: str) -> str:
    """
    Преобразует короткие имена в полные имена в тексте.

    Функция ищет короткие имена в тексте и заменяет их на полные имена.
    Учитывает регистр первой буквы, границы слов и падежи.

    Args:
        text: Исходный текст, который может содержать короткие имена

    Returns:
        Текст с преобразованными именами

    Examples:
        >>> expand_name_in_text("какие трудозатраты у Стаса Чашина")
        'какие трудозатраты у Станислава Чашина'
        >>> expand_name_in_text("Покажи задачи Коли")
        'Покажи задачи Николая'
    """
    if not text:
        return text

    result = text

    # Сортируем по длине (от длинных к коротким), чтобы избежать конфликтов
    # Например, "настюша" должна обрабатываться раньше "настя"
    sorted_mappings = sorted(
        NAME_MAPPINGS.items(), key=lambda x: len(x[0]), reverse=True
    )

    for short_name, full_name in sorted_mappings:
        # Создаем паттерн для поиска короткого имени с учетом границ слов
        # и регистра первой буквы
        pattern = r"\b" + re.escape(short_name) + r"\b"

        def replace_func(match: re.Match) -> str:
            """Функция замены с сохранением регистра."""
            matched = match.group(0)
            # Если первая буква заглавная, делаем полное имя с заглавной
            if matched[0].isupper():
                return full_name
            return full_name.lower()

        result = re.sub(pattern, replace_func, result, flags=re.IGNORECASE)

    return result


def expand_name(name: str) -> str:
    """
    Преобразует короткое имя в полное имя.

    Args:
        name: Короткое имя (например, "Стас", "Коля")

    Returns:
        Полное имя (например, "Станислав", "Николай") или исходное имя,
        если соответствие не найдено

    Examples:
        >>> expand_name("Стас")
        'Станислав'
        >>> expand_name("Коля")
        'Николай'
        >>> expand_name("Неизвестное")
        'Неизвестное'
    """
    if not name:
        return name

    name_lower = name.lower()
    if name_lower in NAME_MAPPINGS:
        full_name = NAME_MAPPINGS[name_lower]
        # Сохраняем регистр первой буквы
        if name[0].isupper():
            return full_name
        return full_name.lower()

    return name
